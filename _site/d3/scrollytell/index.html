<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/estimands.css">
</head>
<body>
  <main>
    <div><h1>Average Treatment Effects</h2>

      <p>Let's revisit the HyperShoe example from the potential outcomes module; a new high performance running shoe called the HyperShoe is released with the claim that wearing the shoe causes faster marathon running times than standard running shoes. We have collected data from 10 runners. 5 of the runners wore HyperShoes and 5 of the runners wore standard shoes. </p>

      <p>What might we want to learn about the effect of the shoes on these runners?  Ideally we'd like to know, for each runner, if the Hypershoe would reduce their running time in a given race. But we have shown [[link to potential outcomes module]] that this is an extremely difficult task since for each person we only observe their running time either with or without the Hypershoe. What if we instead considered the effect of the Hypershoe across all ten runners? </p>

      <p>The <b>average treatment effect (ATE)</b> provides the average of all of the individual level causal effects of HyperShoes across all 10 of the runners in our sample. We saw in the potential outcomes module that there can be individual differences in the causal effect of HyperShoes. Some runners had a huge benefit from HyperShoes while others had no benefit at all. The average treatment effect masks these individual level differences and instead gives us an idea of the general trend. <b>The average treatment effect still relies on within-person comparisons.</b> This is different then simply comparing the average running times between the observed treatment group and the observed control group. We'll walk through calculating the ATE to make these ideas more concrete. </p>

      <br><br><br>
    </div>
    <div class="scrollytell-container">
      <div class="estimands-text-along-d3">

        <!-- <h1>Average treatment effects</h2> -->
        <h2 id="estimands-trigger-1">Factuals</h2>

        <p>We'll start by recording the observed (factual) running times of all 10 runners in our study. <br><br>As shown, 5 of the runners wore HyperShoes while the other 5 runners wore standard shoes.</p>
        

        <br><br><br><br><br><br><br><br><br>

        <p><br></p>

        <h2 id="estimands-trigger-2">Counterfactuals</h2>

        <p>Calculating the ATE also requiors the unobserved counterfactual running times of all 10 runners. The counterfactual running time is the time each runner would have had if they had worn the other shoe. <br><br> This part may appear confussing, how can we use counterfactual outcomes if they aren't observed? We'll cover this later on but for now, imagine we had the impossible power to simulaniously observe factual and coutnerfactual outcomes at the same time. </p>

        <br><br><br><br><br><br><br><br><br>

        <h2 id="estimands-trigger-3">Individual Causal Effects (ICE)</h2>

        <p>When we have both potential outcomes (a y1 and a y0) we can calculate a runners individual casual effect by taking the difference of an individual runner's y1 and y0. The indvidual casual effect tells us how much faster or slower the HyperShoes casued the runners finishign time to be. <br><br> You can hover over a point on the plot to see the Individual Causal Effect of the selected runner:</p>

        <p><a id="estimands-runner-text">Runner 1 has an ICE of -1.69.</a></p>

        <br><br><br><br><br><br><br><br><br>

        <h2 id="estimands-trigger-4">The ATE is the Average of Individual Causal Effects</h2>

        <p>One way of calculating the ATE is by taking the average of all 10 runners Individual Causal Effect's. After averaging all 10 Individual Causal Effects we see that the ATE is -1.33. <br><br> You can hover over any point to exploire a runner's Indivudal Causal Effect and how it related the the ATE. </p>

        <br><br><br><br><br><br><br><br><br>

        <h2 id="estimands-trigger-5">The ATE is the average y1 - the average y0</h2>

        <p>Another way of caluating the ATE is by taking the difference between the average of all y1s and the average of all y0s.<br><br> It is important to note that y1 and y0 both include facutal and counterfactual observations. The values in y1 are finishing times for all 10 runners if they wore HyperShoes and values in y0 are the finishing times of all 10 runners if they wore standard shoes.<br><br> Notice the ATE is the same as when we averaged Individual Causal Effects of all 10 runners. </p>

        <br><br><br><br><br><br><br><br><br>

        <h2 id="estimands-trigger-6">Potential Outcomes Table</h2>

        <p>This potential outcomes table  displays the data in way that may be more conducive to making calculations by hand. <br><br> The average treatment effect is a summary of the entire samples within person comparisons. Remember you can calculate the ATE by taking the average of all 10 runner Individual Causal Effects or by taking the difference of the average y1 and average y0. </p>

        <br><br><br><br><br><br><br><br><br>

        </div>
      <div id="estimands-plot-container" class="estimands-d3-container">
        <div id='estimands-plot-ATE'></div>
      </div>
    </div>
    <br><br><br><br><br>
    <div><h2>Next section after scrollytell</h2>

      <p>Including post-treatment variables can drastically impact the results of experiments. The data for this example was simulated so we know that, on average, the pest-control caused plants to grow 1.52 inches taller than they would have grown without the pest-control. We can see that the analysis without the post-treatment variable <code>bugs</code> is very close to the true treatment effect. The analysis that includes the post-treatment variable <code>bugs</code> is far off from the true treatment effect and would lead an incorrect assessment of the non-toxic environmentally friendly pest-control!</p>

      <p><br></p>

      <h2>Why are analyses with post-treatment variables biased?</h2>

      <p>To demonstrate how adjusting for post-treatment variables introduces bias, consider another hypothetical example: does an exercise program increase muscle strength? The treatment variable <code>z</code> records whether or not an individual participated in the exercise program, the pre-treatment variable. Mid-way through the study, weekly trips to the gym was recorded for each individual with the post-treatment variable <code>gym</code>. </p>

      <p>Post-treatment variables, like <code>gym</code>, have different <a href="">potential outcomes</a> that depend on the treatment variable. This is the primary problem of controlling for post-treatment variables. The table below shows the <a href="">potential outcomes</a> and observed outcomes of <code>gym</code> for 2 individuals from our exercise study.In real contexts, we would not have access to both <a href="">potential outcomes</a> but we can imagine them for the purposes of this example. Notice that two individuals differ in <code>z</code> but have the same value for <code>gym</code> despite haviving different <a href="">potential outcomes</a>. Controlling for <code>gym</code> is not a fair comparison of <code>strength</code> because we are not accounting for how <code>z</code> changes the value of <code>gym</code>. This is not a problem for pre-treatment varibales becuase thier value can not be changed or influenced by <code>z</code>. </p>

      <p>&lt; INSERT DATA TABLE &gt;</p>
    </div>
    <div><h2>Average treatment effects</h2>

      <p>Including post-treatment variables can drastically impact the results of experiments. The data for this example was simulated so we know that, on average, the pest-control caused plants to grow 1.52 inches taller than they would have grown without the pest-control. We can see that the analysis without the post-treatment variable <code>bugs</code> is very close to the true treatment effect. The analysis that includes the post-treatment variable <code>bugs</code> is far off from the true treatment effect and would lead an incorrect assessment of the non-toxic environmentally friendly pest-control!</p>

      <p><br></p>

      <h2>Why are analyses with post-treatment variables biased?</h2>

      <p>To demonstrate how adjusting for post-treatment variables introduces bias, consider another hypothetical example: does an exercise program increase muscle strength? The treatment variable <code>z</code> records whether or not an individual participated in the exercise program, the pre-treatment variable. Mid-way through the study, weekly trips to the gym was recorded for each individual with the post-treatment variable <code>gym</code>. </p>

      <p>Post-treatment variables, like <code>gym</code>, have different <a href="">potential outcomes</a> that depend on the treatment variable. This is the primary problem of controlling for post-treatment variables. The table below shows the <a href="">potential outcomes</a> and observed outcomes of <code>gym</code> for 2 individuals from our exercise study.In real contexts, we would not have access to both <a href="">potential outcomes</a> but we can imagine them for the purposes of this example. Notice that two individuals differ in <code>z</code> but have the same value for <code>gym</code> despite haviving different <a href="">potential outcomes</a>. Controlling for <code>gym</code> is not a fair comparison of <code>strength</code> because we are not accounting for how <code>z</code> changes the value of <code>gym</code>. This is not a problem for pre-treatment varibales becuase thier value can not be changed or influenced by <code>z</code>. </p>

    </div>
    <div><h2>Subsetting by the treatment group treatment effects</h2>

      <p>Sometimes researchers are only interested in summarizing causal effects for a particular set of observations part of the sample. For instance, it may make sense to focus on groups deemed most likely to receive the treatment or on those observations where we have the most data for estimation of a treatment effect.  Let’s return to our original sample of 9 runners. Imagine the 5 runners that wore HyperShoes were professional athletes who were given HyperShoes for free through their sponsorship. Suppose that the marketing team thinks that professional or semi-professional runners are the most likely consumers for this product. Then it might make the most sense to focus on the causal effect just for this type of runner</p>

      <p>The average treatment effect on the treated (ATT) is the average causal effect of the sample with received the treatment (where z = 1). Calculating the ATT reflect whether wearingwould answer if the buying the professional runners HyperShoes caused the professional runnersm to run faster than they would have if they wore standard shoes.</p>

      <p>Why can’t we just use the ATE? Remember that causal inference is a within persons comparison. Sometimes treatments are only given to specific groups (like professional athletes). In situations where our question only relates to the group that received the treatment, we care about summaries that only relate to the group of interest.</p>

      <p>To calculate the ATT we compare the factual outcomes of runner 2, 3, 5, 6 and 8 (the runners who wore HyperShoes) to the counterfactual outcomes of runner 2, 3, 5, 6 and 8. Recall that obtaining counterfactual outcomes requires accessing our potential outcomes time machine. </p>

      <br>

      <div id='estimands-plot-ATT'></div>

      <p>We can also think of the ATT within a potential outcomes table. The potential outcomes for all 9 runners in our sample is shown below. While we have potential outcomes for all 9 runners, ATT only uses data from runners where z = 1: </p>

      <p>average y0 = (2.9 + 2.95  + 3.2 + 3.0  + 3.05 )/5 = 3.02</p>
      <p>average y1 = ( 2.85 + 2.8  + 2.85 + 2.7  + 2.8)/5 = 2.8</p>
      <p>ATT = average y1 - average y0 = -.22</p>

      <p>Note in our example we divide by 5 because our sample has  5 runners with a z value of 1!</p>

      <p>For our sample of 9 runners the ATT of -.22 is different from the ATE of -.15. This is because the ATE and ATT are summarizing different parts of our sample. The ATE is a summary of treatment effect across every runner in the sample while the ATT is a summary of only the 5 runners that wore the HyperShoe for their factual outcome. </p>

      <br>
      <p>&lt; INSERT QUIZ &gt;</p>
      <br>

      <h3>Subsetting by the Control Group</h3>

      <p>In our last example we were interested in a causal question that only pertained to the treated group. We can ask similar questions about the control group. Imagine a different scenario, the governing body that organized marathon races is concerned that runners without HyperShoes are put at a disadvantage. How would the governing body know if runners without HyperShoes would have ran faster had they worn HyperShoes? </p>

      <p>The average treatment effect on the control (ATC) is the average causal effect of the sample that did not receive the treatment (where z = 0). Calculating the ATC would answer if the runners without HyperShoes were at a disadvantage</p>

      <p>Why do we only care about comparisons within the control group? Here we want to know if the group of runners without HyperShoes is disadvantaged without using HyperShoes. It is possible that the HyperShoes only have an effect on the runners that happened to be in the treated group (z = 1) to see if the runners without HyperShoes were disadvantaged we would need to compare the factual and counterfactual outcomes (y1 and y0) for the runners without HyperShoes (z = 0).</p>

      <br>

      <div id='estimands-plot-ATC'></div>

      <p>Closing paragraph</p>

    </div>
  </main>
</body>
<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://d3js.org/d3.v5.js"></script>
<script src="https://cdn.jsdelivr.net/jstat/latest/jstat.min.js"></script> -->
<script src="../src/jquery-3.3.1.slim.min.js"></script>
<script src="../src/d3.v5.js"></script>
<script src="../src/jstat.min.js"></script>
<script src="js/namespace.js"></script>
<script src="js/helpers.js"></script>
<script src="js/scrollPlot.js"></script>
<script src="js/buildTable.js"></script>
<script src="js/buildPlot.js"></script>
<script src="js/init.js"></script>
</html>
